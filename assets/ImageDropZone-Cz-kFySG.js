import{r as E,R as P,j as r}from"./iframe-DzMUKr-y.js";import{g as Z}from"./classnames-helper-C6tUBjOJ.js";import{v as b}from"./validation-helper-Bjp8riig.js";import{I as w}from"./Icon-CpeLWG6P.js";import{I as G}from"./InputError-DIVNNRuu.js";import{S as W}from"./ScrollBar-DJwUB3BM.js";import{M as J}from"./ModalDialog-iBpulPnQ.js";const K=["image/jpeg","image/jpg","image/png"],Q=l=>K.includes(l.type),X=l=>new Promise((i,t)=>{const m=new FileReader;m.onloadend=()=>i(m.result),m.onerror=t,m.readAsDataURL(l)}),H=(l,i,t,m="image/jpeg",d=100,c=0)=>{const a=d/100,n=document.createElement("canvas"),o=n.getContext("2d");return c===90||c===270?(n.width=t,n.height=i):(n.width=i,n.height=t),o&&(o.save(),c!==0&&(o.translate(n.width/2,n.height/2),o.rotate(c*Math.PI/180),o.translate(-n.width/2,-n.height/2)),o.drawImage(l,0,0,i,t),o.restore()),n.toDataURL(m,a)},z=l=>{const t=atob(l.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,"")),m=[];for(let d=0;d<t.length;d+=512){const c=t.slice(d,d+512),a=new Array(c.length);for(let n=0;n<c.length;n++)a[n]=c.charCodeAt(n);m.push(new Uint8Array(a))}return m},ee=(l,i)=>{const t=z(l);return new Blob(t,{type:i})},ae=(l,i,t)=>{const m=z(l);return new File(m,i,{type:t})},re=(l,i,t,m,d=100,c=0,a="image/jpeg",n="file")=>{if(!Q(l))throw new Error("File is not a supported image type.");const o=new FileReader;o.onload=()=>{const v=new Image;v.onload=()=>{const y=H(v,i,t,a,d,c);switch(n){case"blob":m(ee(y,a));break;case"file":m(ae(y,l.name,a));break;case"base64":default:m(y);break}},v.src=o.result},o.onerror=()=>{throw new Error("Failed to read the image file.")},o.readAsDataURL(l)},ne=({className:l,maxImages:i=13,minImages:t=0,imageWidth:m=1024,imageHeight:d=576,accept:c="image/jpeg, image/png",field:a,onChange:n})=>{const[o,v]=E.useState(null),[y,D]=E.useState(null),k=P.useRef(null),R=Z({"image-drop-zone":!0,[l||""]:!!l}),M=()=>k.current?.click(),L=e=>{const s=Array.isArray(a.value)?a.value:[];b({...a,value:[...s,...e]},n)},q=async e=>{const s=Array.isArray(a.value)?a.value:[],u=i-s.length;if(u<=0){b({...a,error:`Maximum ${i} images allowed`},n);return}const g=e.slice(0,u),x=[];for(const j of g){const U=await new Promise(_=>{re(j,m,d,Y=>_(Y),100,0,"image/jpeg","file")}),B=await X(U);x.push(B)}if(L(x),e.length>g.length){const j=e.length-g.length;b({...a,value:[...s,...x],error:`${j} image(s) rejected. Maximum ${i} images allowed.`},n)}},$=e=>{e.preventDefault(),!e.dataTransfer.getData("text/plain").startsWith("internal-drag-")&&e.dataTransfer.files&&e.dataTransfer.files.length>0&&q(Array.from(e.dataTransfer.files))},V=e=>{e.target.files&&q(Array.from(e.target.files))},C=(e,s)=>{const u=[...a.value];[u[e],u[s]]=[u[s],u[e]],b({...a,value:u},n)},A=e=>{const s=[...a.value];s.splice(e,1),b({...a,value:s},n)},I=(e,s)=>{v(s),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`internal-drag-${s}`)},T=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},N=(e,s)=>{e.preventDefault(),o!==null&&o!==s&&C(o,s),v(null)},F=()=>{v(null)},S=e=>{D(e)},O=()=>{D(null)},p=Array.isArray(a.value)?a.value:[],f=p[0],h=p.slice(1);return P.useEffect(()=>{t>0&&p.length<t&&p.length>0?b({...a,error:`Minimum ${t} image${t>1?"s":""} required. You have ${p.length}.`},n):p.length>=t&&a.error?.includes("Minimum")&&b({...a,error:""},n)},[p.length,t,a,n]),r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:R,onDrop:$,onDragOver:e=>e.preventDefault(),children:[r.jsxs("div",{className:"drop-zone",onClick:M,children:[r.jsx(w,{name:"images",size:30,className:"text-secondary"}),r.jsxs("div",{className:"drop-text",children:[r.jsx("strong",{className:"text-primary",style:{cursor:"pointer"},children:"Choose or drop images"}),p.length>0&&r.jsx("div",{className:"reorder-hint",children:"To reorder images, drag and drop them"}),r.jsx("input",{ref:k,type:"file",accept:c,onChange:V,multiple:!0,hidden:!0})]})]}),f&&r.jsxs("div",{className:"images-layout",children:[r.jsxs("div",{className:`main-image ${o===0?"dragging":""}`,draggable:!0,onDragStart:e=>I(e,0),onDragOver:T,onDrop:e=>N(e,0),onDragEnd:F,onClick:()=>S(f),children:[r.jsx("button",{type:"button",className:"delete-button",onClick:e=>{e.stopPropagation(),A(0)},children:r.jsx(w,{name:"x",size:16})}),r.jsx("img",{src:f,alt:"Main preview"})]}),h.length>0&&r.jsx("div",{className:"thumbnails-section",children:r.jsx(W,{variant:"grey",height:"180px",axis:"vertical",children:r.jsxs("div",{className:"thumbnails-grid",children:[h.map((e,s)=>{const u=s+1;return r.jsxs("div",{className:`thumbnail ${o===u?"dragging":""}`,draggable:!0,onDragStart:g=>I(g,u),onDragOver:T,onDrop:g=>N(g,u),onDragEnd:F,onClick:()=>S(e),children:[r.jsx("button",{type:"button",className:"delete-button",onClick:g=>{g.stopPropagation(),A(u)},children:r.jsx(w,{name:"x",size:14})}),r.jsx("img",{src:e,alt:`Preview ${u}`})]},u)}),h.length<i-1&&r.jsx(r.Fragment,{children:Array.from({length:i-1-h.length},(e,s)=>r.jsx("div",{className:"thumbnail empty"},`empty-${s}`))})]})})})]}),a.error&&r.jsx(G,{error:a.error})]}),y&&r.jsx(J,{className:"image-modal",isOpen:!0,size:"lg",onClose:O,children:r.jsx("div",{className:"image-modal-body",children:r.jsx("img",{src:y,alt:"Enlarged view"})})})]})};ne.__docgenInfo={description:"",methods:[],displayName:"ImageDropZone",props:{className:{required:!1,tsType:{name:"string"},description:""},maxImages:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"13",computed:!1}},minImages:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0",computed:!1}},imageWidth:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1024",computed:!1}},imageHeight:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"576",computed:!1}},accept:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"image/jpeg, image/png"',computed:!1}},field:{required:!0,tsType:{name:"intersection",raw:"FormFieldProps & { value: string[] }",elements:[{name:"signature",type:"object",raw:`{
  value: FormFieldValueProps;
  name: string;
  formName: string;
  error: string;
  section: number;
  validate: ValidateProps;
}`,signature:{properties:[{key:"value",value:{name:"union",raw:`| string
| number
| boolean
| File
| File[]
| null
| Array<string>`,elements:[{name:"string"},{name:"number"},{name:"boolean"},{name:"File"},{name:"Array",elements:[{name:"File"}],raw:"File[]"},{name:"null"},{name:"Array",elements:[{name:"string"}],raw:"Array<string>"}],required:!0}},{key:"name",value:{name:"string",required:!0}},{key:"formName",value:{name:"string",required:!0}},{key:"error",value:{name:"string",required:!0}},{key:"section",value:{name:"number",required:!0}},{key:"validate",value:{name:"signature",type:"object",raw:`{
  noValidate?: boolean;
  required?: boolean;
  minStrLength?: number;
  maxStrLength?: number;
  type?: "number" | "text" | "email" | "password";
  minImages?: number;
  maxImages?: number;
  isImagesList?: boolean;
  fileSize?: number;
  dateTimePicker?: boolean;
  dateTimeRangePicker?: boolean;
  email?: boolean;
  phone?: boolean;
  integer?: boolean;
  isYoutubeUrl?: boolean;
}`,signature:{properties:[{key:"noValidate",value:{name:"boolean",required:!1}},{key:"required",value:{name:"boolean",required:!1}},{key:"minStrLength",value:{name:"number",required:!1}},{key:"maxStrLength",value:{name:"number",required:!1}},{key:"type",value:{name:"union",raw:'"number" | "text" | "email" | "password"',elements:[{name:"literal",value:'"number"'},{name:"literal",value:'"text"'},{name:"literal",value:'"email"'},{name:"literal",value:'"password"'}],required:!1}},{key:"minImages",value:{name:"number",required:!1}},{key:"maxImages",value:{name:"number",required:!1}},{key:"isImagesList",value:{name:"boolean",required:!1}},{key:"fileSize",value:{name:"number",required:!1}},{key:"dateTimePicker",value:{name:"boolean",required:!1}},{key:"dateTimeRangePicker",value:{name:"boolean",required:!1}},{key:"email",value:{name:"boolean",required:!1}},{key:"phone",value:{name:"boolean",required:!1}},{key:"integer",value:{name:"boolean",required:!1}},{key:"isYoutubeUrl",value:{name:"boolean",required:!1}}]},required:!0}}]}},{name:"signature",type:"object",raw:"{ value: string[] }",signature:{properties:[{key:"value",value:{name:"Array",elements:[{name:"string"}],raw:"string[]",required:!0}}]}}]},description:""}}};export{ne as I};
